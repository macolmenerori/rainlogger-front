# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a React/TypeScript web application for RainLogger, a rainfall monitoring system. The frontend allows users to log and track rainfall amounts.

## Development Commands

- **Development server**: `pnpm dev` (React Router dev server on port 3000)
- **Build**: `pnpm build` (React Router build, output to `dist/`)
- **Preview**: `pnpm preview` (preview production build locally on port 3000)
- **Test**: `pnpm test` (Vitest - not yet configured)
- **Linting**: `pnpm lint` (ESLint with auto-fix)
- **Formatting**: `pnpm prettify` (Prettier formatting)
- **Type checking**: `pnpm types` (React Router typegen + TypeScript compiler check)

## Architecture

### React Router Framework Mode
This project uses **React Router v7 in framework mode** (SPA, no SSR).

- **Config**: `react-router.config.ts` - framework settings (`ssr: false`, `buildDirectory: 'dist'`)
- **Root**: `app/root.tsx` - i18n initialization (side-effect import), font imports, `App` component (with `ThemeProvider` + `<Outlet />`), and re-exports of `Layout` and `ErrorBoundary`
- **Routes**: `app/routes.ts` - route definitions using `@react-router/dev/routes`
- **Auto-generated types**: `.react-router/types/` (gitignored, generated by `react-router typegen`)

### Route Structure
- `/` → `app/pages/MainPage/MainPage.tsx`
- `/newlog` → `app/pages/NewLog/NewLog.tsx`
- `/watchlogs` → `app/pages/WatchLogs/WatchLogs.tsx`
- `/login` → `app/pages/Login/Login.tsx`

### Core Structure
- **Pages**: `app/pages/<PageName>/<PageName>.tsx` - each page exports a default component and a `meta()` function
- **Components**: `app/components/` - shared UI components
  - `LanguageSwitcher/` - Material-UI language switcher component for i18n
- **UI Components**: `app/ui/` - core UI infrastructure
  - `Layout/` - HTML shell component with dynamic lang attribute
  - `ErrorBoundary/` - Error boundary component with translated messages
  - `theme/` - MUI theme configuration
    - `theme.json` - source of truth for palette and typography values (dark mode)
    - `theme.ts` - `createAppTheme(mode)` factory using MUI's `createTheme()`; exports pre-built `appTheme`
    - `ThemeContext.tsx` - `ThemeProvider` component wrapping MUI's `ThemeProvider` + `CssBaseline`
  - `i18n/` - Internationalization configuration
    - `i18n.ts` - i18next initialization and configuration (SSR-safe)
- **Config**: `app/config/` - Application configuration
  - `env.ts` - Centralized environment variables with type safety
- **Types**: `app/types/` - TypeScript type definitions
  - `env.d.ts` - Environment variable type declarations for `import.meta.env`
- **Static files**: `public/` - served at root
  - `locales/` - Translation files
    - `en.json` - English translations
    - `es.json` - Spanish translations (fallback language)

## Technology Stack

- **Frontend**: React 19, TypeScript 5.9
- **Routing**: React Router 7 (framework mode)
- **UI Library**: Material UI 7 (`@mui/material`) with Emotion (`@emotion/react`, `@emotion/styled`)
- **Icons**: `@mui/icons-material`
- **Font**: Roboto via `@fontsource/roboto` (weights 300, 400, 500, 700)
- **Internationalization**: i18next 25, react-i18next 16, i18next-browser-languagedetector 8
- **Environment variables**: dotenv 17
- **Build**: Vite 7 (via `@react-router/dev/vite` plugin)
- **Testing**: Vitest (to be configured)
- **Linting**: ESLint 9 (flat config) with TypeScript, React, jsx-a11y, testing-library, simple-import-sort, and Prettier integration
- **Formatting**: Prettier
- **Package manager**: pnpm

## Internationalization (i18n)

The project uses **i18next** for internationalization with automatic language detection and localStorage persistence.

### Configuration
- **Config file**: `app/ui/i18n/i18n.ts` - i18next initialization (imported as side effect in `root.tsx`)
- **Translation files**: `public/locales/[lang].json` (bundled with Vite, not lazy-loaded)
- **Supported languages**: Spanish (es - fallback), English (en)
- **Language detection**: Browser language + localStorage persistence
- **SSR-safe**: Uses `typeof window !== 'undefined'` checks for React Router build compatibility

### Translation Structure
Translations are organized hierarchically:
```json
{
  "common": { "appName": "...", "loading": "...", "error": "..." },
  "pages": { "mainPage": { "title": "..." }, "login": { "title": "...", "emailLabel": "..." } },
  "components": { "languageSwitcher": { "label": "..." }, "errorBoundary": { "message": "..." } }
}
```

### Usage Patterns

**In components:**
```typescript
import { useTranslation } from 'react-i18next';

export default function MyComponent() {
  const { t } = useTranslation();
  return <h1>{t('pages.myPage.title')}</h1>;
}
```

**For language switching:**
```typescript
const { i18n, t } = useTranslation();
i18n.changeLanguage('en');  // Switch to English
const currentLang = i18n.language;  // Get current language
```

**In meta functions (for page titles):**
```typescript
import i18n from '@/ui/i18n/i18n';

export function meta(_args: Route.MetaArgs) {
  return [{ title: i18n.t('pages.login.title') }];
}
```

### Key Features
- **Dynamic HTML lang attribute**: Updates `<html lang>` automatically when language changes (handled in `Layout` component)
- **Language switcher component**: `app/components/LanguageSwitcher/LanguageSwitcher.tsx` - Material-UI Select dropdown
- **Translated error boundaries**: ErrorBoundary uses i18n for error messages
- **Direct JSON imports**: Translation files bundled with app (no HTTP requests)

## Environment Variables

The project uses **dotenv** to load environment variables from `.env` files, configured through Vite's build system.

### Configuration
- **Vite config**: `vite.config.ts` - loads dotenv and exposes variables via `define` option
- **Environment file**: `.env` - gitignored, contains sensitive values (API URLs, keys)
- **Example file**: `.env.example` - documents required environment variables for developers
- **Type definitions**: `app/types/env.d.ts` - TypeScript types for `import.meta.env`
- **Config module**: `app/config/env.ts` - centralized typed access to environment variables

### Current Environment Variables
```
NODE_ENV=development
BASE_URL_AUTH=https://polar-hamlet-58862-d62925d46f85.herokuapp.com/api
```

### Usage Patterns

**Direct access (Option 1):**
```typescript
const apiUrl = import.meta.env.BASE_URL_AUTH;
const nodeEnv = import.meta.env.NODE_ENV;
```

**Using config module (Option 2 - Recommended):**
```typescript
import { env } from '@/config/env';

const apiUrl = env.baseUrlAuth;
const isDev = env.isDevelopment;
const isProd = env.isProduction;
```

### Key Features
- **Type-safe**: TypeScript autocomplete and type checking for all custom environment variables
- **Build-time injection**: Variables are statically replaced during build (via Vite's `define`)
- **Centralized config**: `env` module provides single source of truth with camelCase naming
- **Vite built-ins available**: `import.meta.env.DEV`, `import.meta.env.PROD`, `import.meta.env.MODE`, `import.meta.env.SSR`

### Important Notes
- Changes to `.env` files require restarting the dev server
- For production builds, create `.env.production` with production-specific values
- Vite loads env files in priority: `.env.production.local` > `.env.production` > `.env.local` > `.env`
- Variables are baked into the bundle at build time (not loaded at runtime)
- `.env` is gitignored; use `.env.example` to document required variables

## Important Notes

- Uses path aliases (`@/*` maps to `app/*`) via `vite-tsconfig-paths`
- ESLint config is in `eslint.config.js` (ES module flat config)
- Build output directory: `dist/`
- `tsconfig.json` includes `rootDirs` for `.react-router/types` auto-generated route types
- Don't use `({}: Type)` destructuring pattern — use `(_args: Type)` instead to avoid `no-empty-pattern` ESLint error
- **Theming**: Only dark mode is active. The `createAppTheme(mode)` factory in `app/ui/theme/theme.ts` accepts `'dark' | 'light'` to support a future light theme. Theme palette values live in `app/ui/theme/theme.json`
- **ThemeProvider placement**: Wraps `<Outlet />` in `App` (`root.tsx`), not in `Layout`. `ErrorBoundary` is intentionally outside ThemeProvider
- **i18n initialization**: Side-effect import `'./ui/i18n/i18n'` must be first import in `root.tsx` (before React imports) to ensure i18n is ready before rendering
- **Component structure**: `Layout` and `ErrorBoundary` are separate files in `app/ui/` but re-exported from `root.tsx` for React Router framework mode
